#!/bin/bash

# Chrome Extension æ‰“åŒ…è„šæœ¬
# åˆ›å»ºå¯åˆ†å‘çš„æ‰©å±•åŒ…

# èŽ·å–ç‰ˆæœ¬å·å‚æ•°ï¼Œé»˜è®¤ä½¿ç”¨git commitçš„çŸ­hash
VERSION=${1:-$(git rev-parse --short HEAD 2>/dev/null || echo "1.0.0")}

# åˆ›å»ºæž„å»ºç›®å½•
BUILD_DIR="build"
PACKAGE_DIR="$BUILD_DIR/chrome-start-page-package"
mkdir -p $BUILD_DIR
rm -rf $PACKAGE_DIR
mkdir -p $PACKAGE_DIR
echo "ðŸš€ å¼€å§‹æ‰“åŒ…Chrome Start Page Plugin v$VERSION..."

# å¤åˆ¶æ‰€æœ‰å¿…è¦çš„æ–‡ä»¶åˆ°æ‰“åŒ…ç›®å½•
echo "ðŸ“ å¤åˆ¶æ‰©å±•æ–‡ä»¶..."
cp -r chrome-extension/* $PACKAGE_DIR/

# ç§»é™¤ä¸å¿…è¦çš„æ–‡ä»¶
echo "ðŸ§¹ æ¸…ç†ä¸å¿…è¦æ–‡ä»¶..."
rm -f $PACKAGE_DIR/scripts/generate-icons.js
rm -f $PACKAGE_DIR/scripts/resize-icon.js
rm -f $PACKAGE_DIR/PROJECT-SUMMARY.md

# åˆ›å»ºZIPåŒ…
echo "ðŸ“¦ åˆ›å»ºZIPåŒ…..."
cd $PACKAGE_DIR
zip -r ../chrome-start-page-v$VERSION.zip . -x "*.DS_Store" "*/.git/*" "*/node_modules/*"
cd ../..

# åˆ›å»ºå®‰è£…è¯´æ˜Žæ–‡ä»¶
echo "ðŸ“‹ åˆ›å»ºå®‰è£…è¯´æ˜Ž..."
cat > $PACKAGE_DIR/INSTALL.md << 'EOF'
# Chrome Start Page Plugin - å®‰è£…æŒ‡å—

## ðŸ“¦ å®‰è£…æ–¹æ³•

### æ­¥éª¤1: å‡†å¤‡æ‰©å±•æ–‡ä»¶
ç¡®ä¿æ‚¨æœ‰ä»¥ä¸‹æ–‡ä»¶ï¼š
- `manifest.json`
- `new-tab.html`
- `popup.html`
- `js/` æ–‡ä»¶å¤¹ï¼ˆåŒ…å«æ‰€æœ‰JavaScriptæ–‡ä»¶ï¼‰
- `css/` æ–‡ä»¶å¤¹ï¼ˆåŒ…å«æ ·å¼æ–‡ä»¶ï¼‰
- `icons/` æ–‡ä»¶å¤¹ï¼ˆåŒ…å«å›¾æ ‡æ–‡ä»¶ï¼‰

### æ­¥éª¤2: åœ¨Chromeä¸­åŠ è½½æ‰©å±•
1. æ‰“å¼€Chromeæµè§ˆå™¨
2. åœ¨åœ°å€æ è¾“å…¥ï¼š`chrome://extensions/`
3. åœ¨å³ä¸Šè§’å¼€å¯"å¼€å‘è€…æ¨¡å¼"
4. ç‚¹å‡»"åŠ è½½å·²è§£åŽ‹çš„æ‰©å±•ç¨‹åº"
5. é€‰æ‹©åŒ…å«æ‰€æœ‰æ–‡ä»¶çš„æ–‡ä»¶å¤¹
6. æ‰©å±•å°†è‡ªåŠ¨å®‰è£…å¹¶å¯ç”¨

### æ­¥éª¤3: éªŒè¯å®‰è£…
1. æ‰“å¼€æ–°æ ‡ç­¾é¡µï¼Œç¡®è®¤æ˜¾ç¤ºè‡ªå®šä¹‰é¦–é¡µ
2. æµè§ˆå™¨å·¥å…·æ åº”è¯¥æ˜¾ç¤ºæ‰©å±•å›¾æ ‡

## ðŸ§ª åŠŸèƒ½æµ‹è¯•
å®‰è£…å®ŒæˆåŽï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½ï¼š

### æµ‹è¯•1: åˆ›å»ºåˆ†ç»„
1. ç‚¹å‡»"æ·»åŠ åˆ†ç»„"æŒ‰é’®
2. è¾“å…¥åˆ†ç»„åç§°ï¼ˆå¦‚"å·¥ä½œ"ï¼‰
3. ç¡®è®¤åˆ†ç»„å‡ºçŽ°åœ¨ç½‘æ ¼ä¸­

### æµ‹è¯•2: æ·»åŠ ä¹¦ç­¾
1. ç‚¹å‡»"æ·»åŠ ä¹¦ç­¾"æŒ‰é’®
2. è¾“å…¥æ ‡é¢˜å’Œç½‘å€
3. é€‰æ‹©æ‰€å±žåˆ†ç»„
4. ç¡®è®¤ä¹¦ç­¾å‡ºçŽ°åœ¨ç›¸åº”åˆ†ç»„ä¸­

### æµ‹è¯•3: æ•°æ®æŒä¹…åŒ–
1. åˆ›å»ºä¸€äº›åˆ†ç»„å’Œä¹¦ç­¾
2. å…³é—­æµè§ˆå™¨
3. é‡æ–°æ‰“å¼€æµè§ˆå™¨
4. æ‰“å¼€æ–°æ ‡ç­¾é¡µ
5. ç¡®è®¤æ•°æ®ä»ç„¶å­˜åœ¨

## ðŸ†˜ å¸¸è§é—®é¢˜
å¦‚æžœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. Chromeç‰ˆæœ¬æ˜¯å¦ä¸º88+
2. å¼€å‘è€…æ¨¡å¼æ˜¯å¦å·²å¯ç”¨
3. æ–‡ä»¶ç»“æž„æ˜¯å¦å®Œæ•´
4. æŽ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

## ðŸ“ž æ”¯æŒ
å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†çš„TESTING.mdæ–‡ä»¶ã€‚

---
Chrome Start Page Plugin v1.0.0
EOF

# æ˜¾ç¤ºæ‰“åŒ…ç»“æžœ
echo ""
echo "âœ… æ‰“åŒ…å®Œæˆï¼"
echo "ðŸ“‚ æ‰“åŒ…ç›®å½•: $PACKAGE_DIR"
echo "ðŸ“¦ ZIPæ–‡ä»¶: build/chrome-start-page-v$VERSION.zip"
echo ""
echo "ðŸ“‹ åŒ…å«çš„æ–‡ä»¶:"
ls -la $PACKAGE_DIR/
echo ""
echo "ðŸš€ å®‰è£…æ­¥éª¤:"
echo "1. è§£åŽ‹ build/chrome-start-page-v$VERSION.zip"
echo "2. åœ¨Chromeä¸­æ‰“å¼€ chrome://extensions/"
echo "3. å¼€å¯å¼€å‘è€…æ¨¡å¼"
echo "4. åŠ è½½å·²è§£åŽ‹çš„æ‰©å±•ç¨‹åº"
echo "5. é€‰æ‹©è§£åŽ‹åŽçš„æ–‡ä»¶å¤¹"
echo ""
echo "ðŸŽ‰ äº«å—æ‚¨çš„è‡ªå®šä¹‰æ–°æ ‡ç­¾é¡µï¼"